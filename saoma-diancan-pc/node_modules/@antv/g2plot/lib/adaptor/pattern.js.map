{"version":3,"file":"pattern.js","sourceRoot":"","sources":["../../src/adaptor/pattern.ts"],"names":[],"mappings":";;;;AAAA,+BAAgC;AAChC,mCAAiC;AACjC,4CAAoD;AAGpD,kCAAsC;AAOtC;;;;;;GAMG;AACH,SAAgB,OAAO,CAAC,GAAW;IAAnC,iBA8CC;IA7CC,OAAO,UAAgE,MAAiB;;QAC9E,IAAA,OAAO,GAAY,MAAM,QAAlB,EAAE,KAAK,GAAK,MAAM,MAAX,CAAY;QAC1B,IAAS,aAAa,GAAK,OAAO,QAAZ,CAAa;QAE3C,sBAAsB;QACtB,IAAI,CAAC,aAAa,EAAE;YAClB,OAAO,MAAM,CAAC;SACf;QAED,+BAA+B;QAE/B,IAAM,KAAK,GAAc,UAAC,KAAa;;YAAE,cAAc;iBAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;gBAAd,6BAAc;;YAC7C,IAAA,YAAY,GAAK,KAAK,CAAC,QAAQ,EAAE,aAArB,CAAsB;YAC1C,IAAI,KAAK,GAAG,YAAY,CAAC;YAEzB,IAAM,cAAc,eAAG,KAAK,CAAC,UAAU,0CAAG,CAAC,2CAAG,YAAY,CAAC,OAAO,CAAC,CAAC;YACpE,IAAI,cAAc,EAAE;gBAClB,IAAM,UAAU,GAAG,cAAc,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC;gBACjD,IAAM,WAAW,GAAG,UAAG,CAAC,KAAK,EAAE,UAAU,CAAC,CAAC;gBAC3C,KAAK,GAAG,SAAI,CAAC,eAAe,CAAC,cAAc,EAAE,WAAW,EAAE,OAAA,cAAc,CAAC,MAAM,0CAAG,CAAC,MAAK,YAAY,CAAC,CAAC;aACvG;YAED,IAAI,OAAO,GAAkB,aAA8B,CAAC;YAE5D,qFAAqF;YACrF,IAAI,OAAO,aAAa,KAAK,UAAU,EAAE;gBACvC,OAAO,GAAG,aAAa,CAAC,IAAI,CAAC,KAAI,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;aAClD;YAED,qDAAqD;YACrD,IAAI,OAAO,YAAY,aAAa,KAAK,KAAK,EAAE;gBAC9C,mDAAmD;gBACnD,OAAO,GAAG,0BAAgB,CAAC,kBAAU,CAAC,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,eAAe,EAAE,KAAK,EAAE,EAAE,EAAE,OAAO,CAAC,CAAC,CAAC;aAC1F;YAED,IAAM,WAAW,GAAG,OAAO,CAAC,GAAG,CAAc,CAAC;YAE9C,6CACK,CAAC,OAAO,WAAW,KAAK,UAAU,CAAC,CAAC,CAAC,WAAW,CAAC,IAAI,OAAhB,WAAW,0BAAM,KAAI,EAAE,KAAK,GAAK,IAAI,GAAE,CAAC,CAAC,WAAW,IAAI,EAAE,CAAC,KACnG,IAAI,EAAE,OAAO,IAAI,KAAK,IACtB;QACJ,CAAC,CAAC;QAEF,OAAO,kBAAU,CAAC,EAAE,EAAE,MAAM,EAAE,EAAE,OAAO,YAAI,GAAC,GAAG,IAAG,KAAK,KAAE,EAAE,CAAC,CAAC;IAC/D,CAAC,CAAC;AACJ,CAAC;AA9CD,0BA8CC","sourcesContent":["import { Util } from '@antv/g2';\nimport { get } from '@antv/util';\nimport { getCanvasPattern } from '../utils/pattern';\nimport { Params } from '../core/adaptor';\nimport { Datum, Options, StyleAttr } from '../types';\nimport { deepAssign } from '../utils';\n\n/**\n * ä½¿ç”¨ Pattern é€šé“çš„ optionsï¼Œè¦æ±‚æœ‰ colorField/seriesField/stackField ä½œä¸ºåˆ†ç±»å­—æ®µï¼ˆè¿›è¡Œé¢œè‰²æ˜ å°„ï¼‰\n */\ntype OptionsRequiredInPattern = Omit<Options, 'data'>;\n\n/**\n * Pattern é€šé“ï¼Œå¤„ç†å›¾æ¡ˆå¡«å……\n * ğŸš€ ç›®å‰æ”¯æŒå›¾è¡¨ç±»å‹ï¼šé¥¼å›¾ã€æŸ±çŠ¶å›¾ã€æ¡å½¢å›¾ã€ç‰çå›¾ç­‰ï¼ˆä¸æ”¯æŒåœ¨å¤š view å›¾è¡¨ä¸­ï¼Œåç»­æŒ‰éœ€æ‰©å±•ï¼‰\n *\n * @param key key of style property\n * @returns\n */\nexport function pattern(key: string) {\n  return <O extends OptionsRequiredInPattern = OptionsRequiredInPattern>(params: Params<O>): Params<O> => {\n    const { options, chart } = params;\n    const { pattern: patternOption } = options;\n\n    // æ²¡æœ‰ pattern é…ç½®ï¼Œåˆ™ç›´æ¥è¿”å›\n    if (!patternOption) {\n      return params;\n    }\n\n    /** ~~~~~~~ è¿›è¡Œè´´å›¾å›¾æ¡ˆå¤„ç† ~~~~~~~ */\n\n    const style: StyleAttr = (datum?: Datum, ...args: any[]) => {\n      const { defaultColor } = chart.getTheme();\n      let color = defaultColor;\n\n      const colorAttribute = chart.geometries?.[0]?.getAttribute('color');\n      if (colorAttribute) {\n        const colorField = colorAttribute.getFields()[0];\n        const seriesValue = get(datum, colorField);\n        color = Util.getMappingValue(colorAttribute, seriesValue, colorAttribute.values?.[0] || defaultColor);\n      }\n\n      let pattern: CanvasPattern = patternOption as CanvasPattern;\n\n      // 1. å¦‚æœ patternOption æ˜¯ä¸€ä¸ªå›è°ƒï¼Œåˆ™è·å–å›è°ƒç»“æœã€‚`(datum: Datum, color: string) => CanvasPattern`\n      if (typeof patternOption === 'function') {\n        pattern = patternOption.call(this, datum, color);\n      }\n\n      // 2. å¦‚æœ pattern ä¸æ˜¯ CanvasPatternï¼Œåˆ™è¿›ä¸€æ­¥å¤„ç†ï¼Œå¦åˆ™ç›´æ¥èµ‹äºˆç»™ fill\n      if (pattern instanceof CanvasPattern === false) {\n        // é€šè¿‡ createPattern(PatternStyle) è½¬æ¢ä¸º CanvasPattern\n        pattern = getCanvasPattern(deepAssign({}, { cfg: { backgroundColor: color } }, pattern));\n      }\n\n      const styleOption = options[key] as StyleAttr;\n\n      return {\n        ...(typeof styleOption === 'function' ? styleOption.call(this, datum, ...args) : styleOption || {}),\n        fill: pattern || color,\n      };\n    };\n\n    return deepAssign({}, params, { options: { [key]: style } });\n  };\n}\n"]}