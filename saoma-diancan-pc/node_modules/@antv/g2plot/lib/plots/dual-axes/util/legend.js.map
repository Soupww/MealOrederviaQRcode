{"version":3,"file":"legend.js","sourceRoot":"","sources":["../../../../src/plots/dual-axes/util/legend.ts"],"names":[],"mappings":";;;AAAA,mCAA8D;AAC9D,+BAAsC;AACtC,wCAA0D;AAG1D,mCAAkC;AAElC;;;GAGG;AACH,SAAgB,kBAAkB,CAAC,MAKlC;IACS,IAAA,IAAI,GAAqC,MAAM,KAA3C,EAAE,cAAc,GAAqB,MAAM,eAA3B,EAAE,MAAM,GAAa,MAAM,OAAnB,EAAE,MAAM,GAAK,MAAM,OAAX,CAAY;IACxD,IAAM,UAAU,GAAG,UAAG,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IAEzC,IAAM,QAAQ,GAAG,oBAAY,CAAC,IAAI,EAAE,eAAM,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC;IAClF,IAAI,CAAC,cAAc,CAAC,WAAW,EAAE;QAC/B,IAAM,cAAc,GAAG,UAAG,CAAC,IAAI,EAAE,oBAAkB,MAAM,WAAQ,CAAC,IAAI,MAAM,CAAC;QAC7E,cAAc;QACd,IAAM,cAAc,GAAG,QAAQ,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;QACtD,IAAM,KAAK,GAAG,SAAI,CAAC,eAAe,CAAC,cAAc,EAAE,cAAc,EAAE,cAAc,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;QAE7F,IAAM,MAAM,GACV,CAAC,iBAAU,CAAC,UAAU,CAAC;YACrB,CAAC,CAAC,UAAU;YACZ,CAAC,CAAC,CAAC,cAAO,CAAC,UAAU,CAAC;gBACpB,kBAAU,CACR,EAAE,EACF;oBACE,KAAK,EAAE;wBACL,MAAM,EAAE,KAAK;wBACb,IAAI,EAAE,KAAK;qBACZ;iBACF,EACD,UAAU,CACX,CAAC;YACN,CAAC,eAAM,CAAC,cAAc,CAAC;gBACrB,CAAC,CAAC;oBACE,MAAM,EAAE,UAAC,CAAS,EAAE,CAAS,EAAE,CAAS;wBACtC,OAAO;4BACL,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;4BACf,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;yBAChB,CAAC;oBACJ,CAAC;oBACD,KAAK,EAAE;wBACL,SAAS,EAAE,CAAC;wBACZ,CAAC,EAAE,CAAC;wBACJ,MAAM,EAAE,KAAK;qBACd;iBACF;gBACH,CAAC,CAAC;oBACE,MAAM,EAAE,QAAQ;oBAChB,KAAK,EAAE;wBACL,IAAI,EAAE,KAAK;qBACZ;iBACF,CAAC,CAAC;QACT,OAAO;YACL;gBACE,KAAK,EAAE,MAAM;gBACb,IAAI,EAAE,cAAc;gBACpB,MAAM,QAAA;gBACN,UAAU,EAAE,IAAI;gBAChB,MAAM,EAAE,IAAI,CAAC,EAAE;aAChB;SACF,CAAC;KACH;IAED,IAAM,UAAU,GAAG,QAAQ,CAAC,kBAAkB,EAAE,CAAC;IACjD,OAAO,aAAM,CACX,UAAU,EACV,UAAC,KAAK,EAAE,IAAI;QACV,IAAM,SAAS,GAAG,SAAI,CAAC,cAAc,CAAC,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,IAAI,CAAC,QAAQ,EAAE,EAAE,UAAU,CAAC,CAAC;QACzF,OAAO,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;IACjC,CAAC,EACD,EAAE,CACH,CAAC;AACJ,CAAC;AAtED,gDAsEC","sourcesContent":["import { reduce, get, isEmpty, isFunction } from '@antv/util';\nimport { View, Util } from '@antv/g2';\nimport { deepAssign, findGeometry } from '../../../utils';\nimport { GeometryOption } from '../types';\nimport { Legend } from '../../../types/legend';\nimport { isLine } from './option';\n\n/**\n * 获取 view 的 legendItem，供存在不含有 seriesField 的图形使用\n * @param params\n */\nexport function getViewLegendItems(params: {\n  view: View;\n  yField: string;\n  geometryOption: GeometryOption;\n  legend: Legend;\n}) {\n  const { view, geometryOption, yField, legend } = params;\n  const userMarker = get(legend, 'marker');\n\n  const geometry = findGeometry(view, isLine(geometryOption) ? 'line' : 'interval');\n  if (!geometryOption.seriesField) {\n    const legendItemName = get(view, `options.scales.${yField}.alias`) || yField;\n    // 返回 g2 设置的图例\n    const colorAttribute = geometry.getAttribute('color');\n    const color = Util.getMappingValue(colorAttribute, legendItemName, colorAttribute.values[0]);\n\n    const marker =\n      (isFunction(userMarker)\n        ? userMarker\n        : !isEmpty(userMarker) &&\n          deepAssign(\n            {},\n            {\n              style: {\n                stroke: color,\n                fill: color,\n              },\n            },\n            userMarker\n          )) ||\n      (isLine(geometryOption)\n        ? {\n            symbol: (x: number, y: number, r: number) => {\n              return [\n                ['M', x - r, y],\n                ['L', x + r, y],\n              ];\n            },\n            style: {\n              lineWidth: 2,\n              r: 6,\n              stroke: color,\n            },\n          }\n        : {\n            symbol: 'square',\n            style: {\n              fill: color,\n            },\n          });\n    return [\n      {\n        value: yField,\n        name: legendItemName,\n        marker,\n        isGeometry: true,\n        viewId: view.id,\n      },\n    ];\n  }\n\n  const attributes = geometry.getGroupAttributes();\n  return reduce(\n    attributes,\n    (items, attr) => {\n      const attrItems = Util.getLegendItems(view, geometry, attr, view.getTheme(), userMarker);\n      return items.concat(attrItems);\n    },\n    []\n  );\n}\n"]}