"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.adaptor = exports.interaction = void 0;
var tslib_1 = require("tslib");
var util_1 = require("@antv/util");
var polygon_1 = require("../../adaptor/geometries/polygon");
var common_1 = require("../../adaptor/common");
var pattern_1 = require("../../adaptor/pattern");
var utils_1 = require("../../utils");
var padding_1 = require("../../utils/padding");
var utils_2 = require("./utils");
/**
 * è·å–é»˜è®¤ option
 * @param params
 */
function defaultOptions(params) {
    var options = params.options;
    var colorField = options.colorField;
    return utils_1.deepAssign({
        options: {
            rawFields: ['value'],
            tooltip: {
                fields: ['name', 'value', colorField, 'path'],
                formatter: function (data) {
                    return {
                        name: data.name,
                        value: data.value,
                    };
                },
            },
        },
    }, params);
}
/**
 * å­—æ®µ
 * @param params
 */
function geometry(params) {
    var chart = params.chart, options = params.options;
    var color = options.color, colorField = options.colorField, rectStyle = options.rectStyle, hierarchyConfig = options.hierarchyConfig, rawFields = options.rawFields;
    var data = utils_2.transformData({
        data: options.data,
        colorField: options.colorField,
        enableDrillDown: utils_2.enableDrillInteraction(options),
        hierarchyConfig: hierarchyConfig,
    });
    chart.data(data);
    // geometry
    polygon_1.polygon(utils_1.deepAssign({}, params, {
        options: {
            xField: 'x',
            yField: 'y',
            seriesField: colorField,
            rawFields: rawFields,
            polygon: {
                color: color,
                style: rectStyle,
            },
        },
    }));
    // åšä¸€ä¸ªåè½¬ï¼Œè¿™æ ·é…åˆæ’åºï¼Œå¯ä»¥å°†æœ€å¤§å€¼æ”¾åˆ°å·¦ä¸Šè§’ï¼Œæœ€å°å€¼æ”¾åˆ°å³ä¸‹è§’
    chart.coordinate().reflect('y');
    return params;
}
/**
 * åæ ‡è½´
 * @param params
 */
function axis(params) {
    var chart = params.chart;
    chart.axis(false);
    return params;
}
function adaptorInteraction(options) {
    var drilldown = options.drilldown, _a = options.interactions, interactions = _a === void 0 ? [] : _a;
    var enableDrillDown = utils_2.enableDrillInteraction(options);
    if (enableDrillDown) {
        return utils_1.deepAssign({}, options, {
            interactions: tslib_1.__spreadArrays(interactions, [
                {
                    type: 'drill-down',
                    // ğŸš“ è¿™ä¸æ˜¯ä¸€ä¸ªè§„èŒƒçš„ APIï¼Œåç»­ä¼šå˜æ›´ã€‚æ…é‡å‚è€ƒ
                    cfg: { drillDownConfig: drilldown, transformData: utils_2.transformData },
                },
            ]),
        });
    }
    return options;
}
/**
 * Interaction é…ç½®
 * @param params
 */
function interaction(params) {
    var chart = params.chart, options = params.options;
    var interactions = options.interactions, drilldown = options.drilldown;
    common_1.interaction({
        chart: chart,
        options: adaptorInteraction(options),
    });
    // é€‚é… view-zoom
    var viewZoomInteraction = utils_2.findInteraction(interactions, 'view-zoom');
    if (viewZoomInteraction) {
        // å¼€å¯ç¼©æ”¾ interaction åï¼Œåˆ™é˜»æ­¢é»˜è®¤æ»šåŠ¨äº‹ä»¶ï¼Œé¿å…æ•´ä¸ªçª—å£çš„æ»šåŠ¨
        if (viewZoomInteraction.enable !== false) {
            chart.getCanvas().on('mousewheel', function (ev) {
                ev.preventDefault();
            });
        }
        else {
            // æ‰‹åŠ¨å…³é—­åï¼Œæ¸…é™¤ã€‚ä»…å¯¹å£°æ˜ viewZoomInteraction çš„æ¸…é™¤ã€‚
            chart.getCanvas().off('mousewheel');
        }
    }
    // é€‚åº”ä¸‹é’»äº¤äº’é¢åŒ…å±‘
    var enableDrillDown = utils_2.enableDrillInteraction(options);
    if (enableDrillDown) {
        // ä¸ºé¢åŒ…å±‘åœ¨åº•éƒ¨ç•™å‡º 25px çš„ç©ºé—´
        chart.appendPadding = padding_1.getAdjustAppendPadding(chart.appendPadding, util_1.get(drilldown, ['breadCrumb', 'position']));
    }
    return params;
}
exports.interaction = interaction;
/**
 * çŸ©å½¢æ ‘å›¾
 * @param chart
 * @param options
 */
function adaptor(params) {
    return utils_1.flow(defaultOptions, common_1.theme, pattern_1.pattern('rectStyle'), geometry, axis, common_1.legend, common_1.tooltip, interaction, common_1.animation, common_1.annotation())(params);
}
exports.adaptor = adaptor;
//# sourceMappingURL=adaptor.js.map