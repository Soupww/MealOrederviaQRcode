{"version":3,"file":"pie-statistic-action.js","sourceRoot":"","sources":["../../../../src/plots/pie/interactions/pie-statistic-action.ts"],"names":[],"mappings":"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","sourcesContent":["import { View, Action, Util, Types } from '@antv/g2';\nimport { each, get } from '@antv/util';\nimport { PieOptions } from '..';\nimport { Annotation } from '../../../types/annotation';\nimport { renderStatistic } from '../../../utils/statistic';\n/**\n * Pie 中心文本事件的 Action\n */\nexport class StatisticAction extends Action {\n  private initialAnnotation;\n\n  private getAnnotations(_view?: View): object[] {\n    const view = _view || this.context.view;\n    // @ts-ignore\n    return view.getController('annotation').option;\n  }\n\n  private getInitialAnnotation(): Types.ComponentOption[] | null {\n    return this.initialAnnotation;\n  }\n\n  init() {\n    const { view } = this.context;\n    view.removeInteraction('tooltip');\n\n    view.on('afterchangesize', () => {\n      const annotations = this.getAnnotations(view);\n      this.initialAnnotation = annotations;\n    });\n  }\n\n  public change(arg?: Pick<PieOptions, 'annotations' | 'statistic'>) {\n    const { view, event } = this.context;\n    if (!this.initialAnnotation) {\n      this.initialAnnotation = this.getAnnotations();\n    }\n\n    let data = get(event, ['data', 'data']);\n    if (event.type.match('legend-item')) {\n      const delegateObject = Util.getDelegationObject(this.context);\n      // @ts-ignore\n      const colorField = view.getGroupedFields()[0];\n      if (delegateObject && colorField) {\n        const { item } = delegateObject;\n        data = view.getData().find((d) => d[colorField] === item.value);\n      }\n    }\n\n    if (data) {\n      const annotations = get(arg, 'annotations', []);\n      const statistic = get(arg, 'statistic', {});\n      // 先清空标注，再重新渲染\n      view.getController('annotation').clear(true);\n      // 先进行其他 annotations，再去渲染统计文本\n      each(annotations, (annotation: Annotation) => {\n        if (typeof annotation === 'object') {\n          view.annotation()[annotation.type](annotation);\n        }\n      });\n      renderStatistic(view, { statistic, plotType: 'pie' }, data);\n      view.render(true);\n    }\n  }\n\n  public reset() {\n    const { view } = this.context;\n    const annotationController = view.getController('annotation');\n    annotationController.clear(true);\n    const initialStatistic = this.getInitialAnnotation();\n    each(initialStatistic, (a) => {\n      view.annotation()[a.type](a);\n    });\n    view.render(true);\n  }\n}\n"]}